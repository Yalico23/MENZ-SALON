let paso=1;const pasoInicial=1,pasoFinal=4,cita={Id:"",Nombre:"",Fecha:"",Hora:"",Servicios:[]};function inciarCita(){tabs(),mostrarSeccion(),btnPaginador(),pagSiguiente(),pagAnterior(),IDUsuario(),NombreUsuario(),SeleccionarFecha(),seleccionarHora(),resumen()}function tabs(){document.querySelectorAll(".tabs button").forEach(e=>{e.addEventListener("click",(function(e){paso=parseInt(e.target.dataset.paso),mostrarSeccion(),btnPaginador()}))})}function mostrarSeccion(){const e=document.querySelector(".mostrar");e&&e.classList.remove("mostrar");document.querySelector("#paso-"+paso).classList.add("mostrar");const t=document.querySelector(".actual");t&&t.classList.remove("actual");document.querySelector(`[data-paso="${paso}"]`).classList.add("actual")}function btnPaginador(){const e=document.querySelector("#boton-anterior"),t=document.querySelector("#boton-siguiente");1===paso?(e.classList.add("ocultar"),t.classList.remove("ocultar")):4===paso?(e.classList.remove("ocultar"),t.classList.add("ocultar")):(e.classList.remove("ocultar"),t.classList.remove("ocultar")),mostrarSeccion(),resumen()}function pagAnterior(){document.querySelector("#boton-anterior").addEventListener("click",(function(){paso<=1||(paso--,btnPaginador())}))}function pagSiguiente(){document.querySelector("#boton-siguiente").addEventListener("click",(function(){paso>=4||(paso++,btnPaginador())}))}function seleccionarServicio(e){const{Id:t}=e,{Servicios:o}=cita;o.some(e=>e.Id===t)?cita.Servicios=o.filter(e=>e.Id!==t):cita.Servicios=[...o,e];document.querySelector(`[data-id-servicio="${t}"]`).classList.toggle("seleccionado")}function IDUsuario(){const e=document.querySelector("#Id").value;cita.Id=e}function NombreUsuario(){const e=document.querySelector("#Nombre").value;cita.Nombre=e}function SeleccionarFecha(){document.querySelector("#Fecha").addEventListener("input",(function(e){const t=new Date(e.target.value).getUTCDay();[6,0].includes(t)?(e.target.value="",mostrarAlerta("Dia no laborable","error",".alertas")):cita.Fecha=e.target.value}))}function seleccionarHora(){document.querySelector("#Hora").addEventListener("input",(function(e){const t=e.target.value.split(":")[0];t<10||t>18?(mostrarAlerta("Hora no valida","error",".alertas"),e.target.value=""):cita.Hora=e.target.value}))}function mostrarAlerta(e,t,o,a=!0){const n=document.querySelector(".alerta");n&&n.remove();const r=document.createElement("DIV");r.textContent=e,r.classList.add("alerta"),r.classList.add(t);document.querySelector(o).appendChild(r),a&&setTimeout(()=>{r.remove()},3e3)}function resumen(){const e=document.querySelector(".contenido-resumen"),t=document.querySelector(".servicio-resumen"),o=document.querySelector(".total-resumen");for(;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)t.removeChild(t.firstChild);for(;o.firstChild;)o.removeChild(o.firstChild);if(Object.values(cita).includes("")||0===cita.Servicios.length)return void mostrarAlerta("Falta completar campos","error",".contenido-resumen",!1);const{Nombre:a,Fecha:n,Hora:r,Servicios:c}=cita,i=document.createElement("H3");i.textContent="Resumen de la Cita",e.appendChild(i);const s=document.createElement("P");s.innerHTML="<span>Nombre:</span> "+a;const l=new Date(n),d=l.getMonth(),u=l.getDate()+2,m=l.getFullYear(),p=new Date(Date.UTC(m,d,u)).toLocaleDateString("es-PE",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),h=document.createElement("P");h.innerHTML="<span>Fecha: </span> "+p;const v=document.createElement("P");v.innerHTML="<span>Hora:</span> "+r;const S=document.createElement("BUTTON");S.classList.add("boton-web"),S.textContent="Reservar Cita",S.onclick=reservarCita,e.appendChild(s),e.appendChild(h),e.appendChild(v),e.appendChild(S);const f=document.createElement("H3");f.textContent="Resumen de los Servicios",e.appendChild(f),c.forEach(e=>{const{Nombre:o,Precio:a}=e,n=document.createElement("DIV");n.classList.add("contenedor-servicio");const r=document.createElement("P");r.textContent=o;const c=document.createElement("P");c.innerHTML="<span>Precio: </span> S/."+a,n.appendChild(r),n.appendChild(c),t.appendChild(n)});const C=document.createElement("H3");C.textContent="Total a Pagar",o.appendChild(C);let g=0;c.forEach(e=>{const{Precio:t}=e;g+=parseFloat(t)});const b=document.createElement("P");b.textContent="Total a Pagar : S/."+g,o.appendChild(b)}async function reservarCita(){const{Hora:e,Fecha:t,Servicios:o,Id:a}=cita,n=o.map(e=>e.Id),r=new FormData;r.append("UsuarioId",a),r.append("Hora",e),r.append("Fecha",t),r.append("Servicios",n);try{const e=location.origin+"/api/citas",t=await fetch(e,{method:"POST",body:r});(await t.json()).resultado&&Swal.fire({icon:"success",title:"Cita Creada",text:"Tu cita fue creada correctamente! Se te mando un comprobante a tu correo",iconColor:"#BD9254"}).then(()=>{comprobante()})}catch(e){console.log(e)}}async function comprobante(){const{Fecha:e,Hora:t,Nombre:o,Servicios:a}=cita;let n=0,r=`Estimado/a ${o}, su cita fue reservada para ${e},a las horas ${t}\n`;r+="Con los siguientes servicios:\n",a.forEach(e=>{n+=parseFloat(e.Precio),r+=`${e.Nombre}, S/.${e.Precio} \n`}),r+="Con un Total de : S/."+n;const c=new FormData;c.append("Mensaje",r);try{const e=location.origin+"/api/msj",t=await fetch(e,{method:"POST",body:c});(await t.json()).resultado&&setTimeout(()=>{window.location.reload(),window.location.href=location.origin+"/cita"},1500)}catch(e){console.log(e)}}document.addEventListener("DOMContentLoaded",(function(){inciarCita()}));